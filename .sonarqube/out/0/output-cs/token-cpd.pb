€
>C:\Sistemas\TRSale\backend\TRSale.Domain\Entites\BaseEntity.cs
	namespace 	
TRSale
 
. 
Domain 
. 
Entites 
{ 
public 

class 

BaseEntity 
{		 
public

 

BaseEntity

 
(

 
)

 
{ 	
this 
. 
Id 
= 
Guid 
. 
NewGuid "
(" #
)# $
;$ %
} 	
public 
Guid 
Id 
{ 
get 
; 
private %
set& )
;) *
}+ ,
} 
} É
8C:\Sistemas\TRSale\backend\TRSale.Domain\Entites\User.cs
	namespace 	
TRSale
 
. 
Domain 
. 
Entites 
{ 
public		 

class		 
User		 
:		 

BaseEntity		 !
{

 
public 
User 
( 
string 
name 
,  
string! '
email( -
,- .
string/ 5
password6 >
)> ?
{ 	
Name 
= 
name 
; 
Email 
= 
email 
; 
Password 
= 
CriptoHelper #
.# $
HashPassword$ 0
(0 1
password1 9
)9 :
;: ;
} 	
public 
string 
Name 
{ 
get  
;  !
private" )
set* -
;- .
}/ 0
public 
string 
Email 
{ 
get !
;! "
private# *
set+ .
;. /
}0 1
public 
string 
Password 
{  
get! $
;$ %
private& -
set. 1
;1 2
}3 4
public 
bool 
Autenticate 
(  
string  &
password' /
)/ 0
{ 	
return 
CriptoHelper 
.   
VerifyHashedPassword  4
(4 5
this5 9
.9 :
Password: B
,B C
passwordD L
)L M
;M N
} 	
} 
} ﬂx
@C:\Sistemas\TRSale\backend\TRSale.Domain\Helpers\CriptoHelper.cs
	namespace 	
TRSale
 
. 
Domain 
. 
Helpers 
{ 
public 

class 
CriptoHelper 
{ 
static 
bool 
ByteArraysEqual #
(# $
byte$ (
[( )
]) *
a1+ -
,- .
byte/ 3
[3 4
]4 5
a26 8
)8 9
{ 	
if		 
(		 
a1		 
.		 
Length		 
!=		 
a2		 
.		  
Length		  &
)		& '
return

 
false

 
;

 
for 
( 
int 
i 
= 
$num 
; 
i 
< 
a1  "
." #
Length# )
;) *
i+ ,
++, .
). /
if 
( 
a1 
[ 
i 
] 
!= 
a2 
[  
i  !
]! "
)" #
return 
false  
;  !
return 
true 
; 
} 	
public 
static 
string 
HashPassword )
() *
string* 0
password1 9
)9 :
{ 	
byte 
[ 
] 
salt 
; 
byte 
[ 
] 
buffer2 
; 
if 
( 
password 
== 
null  
)  !
{ 
throw 
new !
ArgumentNullException /
(/ 0
$str0 :
): ;
;; <
} 
using 
( 
Rfc2898DeriveBytes %
bytes& +
=, -
new. 1
Rfc2898DeriveBytes2 D
(D E
passwordE M
,M N
$numO S
,S T
$numU Z
)Z [
)[ \
{ 
salt 
= 
bytes 
. 
Salt !
;! "
buffer2 
= 
bytes 
.  
GetBytes  (
(( )
$num) -
)- .
;. /
} 
byte   
[   
]   
dst   
=   
new   
byte   !
[  ! "
$num  " &
]  & '
;  ' (
Buffer!! 
.!! 
	BlockCopy!! 
(!! 
salt!! !
,!!! "
$num!!# $
,!!$ %
dst!!& )
,!!) *
$num!!+ ,
,!!, -
$num!!. 2
)!!2 3
;!!3 4
Buffer"" 
."" 
	BlockCopy"" 
("" 
buffer2"" $
,""$ %
$num""& '
,""' (
dst"") ,
,"", -
$num"". 2
,""2 3
$num""4 8
)""8 9
;""9 :
return## 
Convert## 
.## 
ToBase64String## )
(##) *
dst##* -
)##- .
;##. /
}$$ 	
public&& 
static&& 
bool&&  
VerifyHashedPassword&& /
(&&/ 0
string&&0 6
hashedPassword&&7 E
,&&E F
string&&G M
password&&N V
)&&V W
{'' 	
byte(( 
[(( 
](( 
buffer4(( 
;(( 
if)) 
()) 
hashedPassword)) 
==)) !
null))" &
)))& '
{** 
return++ 
false++ 
;++ 
},, 
if-- 
(-- 
password-- 
==-- 
null--  
)--  !
{.. 
throw// 
new// !
ArgumentNullException// /
(/// 0
$str//0 :
)//: ;
;//; <
}00 
byte11 
[11 
]11 
src11 
=11 
Convert11  
.11  !
FromBase64String11! 1
(111 2
hashedPassword112 @
)11@ A
;11A B
if22 
(22 
(22 
src22 
.22 
Length22 
!=22 
$num22 #
)22# $
||22% '
(22( )
src22) ,
[22, -
$num22- .
]22. /
!=220 2
$num223 4
)224 5
)225 6
{33 
return44 
false44 
;44 
}55 
byte66 
[66 
]66 
dst66 
=66 
new66 
byte66 !
[66! "
$num66" &
]66& '
;66' (
Buffer77 
.77 
	BlockCopy77 
(77 
src77  
,77  !
$num77" #
,77# $
dst77% (
,77( )
$num77* +
,77+ ,
$num77- 1
)771 2
;772 3
byte88 
[88 
]88 
buffer388 
=88 
new88  
byte88! %
[88% &
$num88& *
]88* +
;88+ ,
Buffer99 
.99 
	BlockCopy99 
(99 
src99  
,99  !
$num99" &
,99& '
buffer399( /
,99/ 0
$num991 2
,992 3
$num994 8
)998 9
;999 :
using;; 
(;; 
Rfc2898DeriveBytes;; %
bytes;;& +
=;;, -
new;;. 1
Rfc2898DeriveBytes;;2 D
(;;D E
password;;E M
,;;M N
dst;;O R
,;;R S
$num;;T Y
);;Y Z
);;Z [
{<< 
buffer4== 
=== 
bytes== 
.==  
GetBytes==  (
(==( )
$num==) -
)==- .
;==. /
}>> 
return?? 
ByteArraysEqual?? "
(??" #
buffer3??# *
,??* +
buffer4??, 3
)??3 4
;??4 5
}@@ 	
publicBB 
staticBB 
stringBB 
EncryptStringBB *
(BB* +
stringBB+ 1
	plainTextBB2 ;
,BB; <
stringBB= C
keyBBD G
,BBG H
stringBBI O
keyIvBBP U
)BBU V
{CC 	
intDD 
keyByteSizeDD 
=DD 
$numDD  
;DD  !
boolEE 
useHexEE 
=EE 
trueEE 
;EE 
byteFF 
[FF 
]FF 
keyBytesFF 
=FF 
newFF !
byteFF" &
[FF& '
keyByteSizeFF' 2
]FF2 3
;FF3 4
byteGG 
[GG 
]GG 
ivBytesGG 
=GG 
newGG  
byteGG! %
[GG% &
$numGG& (
]GG( )
;GG) *
byteHH 
[HH 
]HH 
cipherBytesHH 
;HH 
ifJJ 
(JJ 
useHexJJ 
)JJ 
{KK 
intLL 
lenLL 
=LL 
keyByteSizeLL %
*LL& '
$numLL( )
;LL) *
forMM 
(MM 
intMM 
iMM 
=MM 
$numMM 
;MM 
iMM  !
<MM" #
lenMM$ '
;MM' (
iMM) *
+=MM+ -
$numMM. /
)MM/ 0
{NN 
keyBytesOO 
[OO 
iOO 
/OO  
$numOO! "
]OO" #
=OO$ %
ConvertOO& -
.OO- .
ToByteOO. 4
(OO4 5
keyOO5 8
.OO8 9
	SubstringOO9 B
(OOB C
iOOC D
,OOD E
$numOOF G
)OOG H
,OOH I
$numOOJ L
)OOL M
;OOM N
ifPP 
(PP 
iPP 
<PP 
$numPP 
)PP 
ivBytesQQ 
[QQ  
iQQ  !
/QQ" #
$numQQ$ %
]QQ% &
=QQ' (
ConvertQQ) 0
.QQ0 1
ToByteQQ1 7
(QQ7 8
keyIvQQ8 =
.QQ= >
	SubstringQQ> G
(QQG H
iQQH I
,QQI J
$numQQK L
)QQL M
,QQM N
$numQQO Q
)QQQ R
;QQR S
}RR 
}SS 
elseTT 
{UU 
keyBytesVV 
=VV 
ConvertVV "
.VV" #
FromBase64StringVV# 3
(VV3 4
keyVV4 7
)VV7 8
;VV8 9
ivBytesWW 
=WW 
ConvertWW !
.WW! "
FromBase64StringWW" 2
(WW2 3
keyIvWW3 8
)WW8 9
;WW9 :
}XX 
usingZZ 
(ZZ 
AesZZ 
aesZZ 
=ZZ 
AesZZ  
.ZZ  !
CreateZZ! '
(ZZ' (
)ZZ( )
)ZZ) *
{[[ 
aes\\ 
.\\ 
Key\\ 
=\\ 
keyBytes\\ "
;\\" #
aes]] 
.]] 
IV]] 
=]] 
ivBytes]]  
;]]  !
ICryptoTransform^^  
	encryptor^^! *
=^^+ ,
aes^^- 0
.^^0 1
CreateEncryptor^^1 @
(^^@ A
aes^^A D
.^^D E
Key^^E H
,^^H I
aes^^J M
.^^M N
IV^^N P
)^^P Q
;^^Q R
using__ 
MemoryStream__ "
memoryStream__# /
=__0 1
new__2 5
MemoryStream__6 B
(__B C
)__C D
;__D E
using`` 
CryptoStream`` "
cryptoStream``# /
=``0 1
new``2 5
CryptoStream``6 B
(``B C
memoryStream``C O
,``O P
	encryptor``Q Z
,``Z [
CryptoStreamMode``\ l
.``l m
Write``m r
)``r s
;``s t
usingaa 
(aa 
StreamWriteraa #
streamWriteraa$ 0
=aa1 2
newaa3 6
StreamWriteraa7 C
(aaC D
cryptoStreamaaD P
)aaP Q
)aaQ R
{bb 
streamWritercc  
.cc  !
Writecc! &
(cc& '
	plainTextcc' 0
)cc0 1
;cc1 2
}dd 
cipherBytesee 
=ee 
memoryStreamee *
.ee* +
ToArrayee+ 2
(ee2 3
)ee3 4
;ee4 5
}ff 
returngg 
Convertgg 
.gg 
ToBase64Stringgg )
(gg) *
cipherBytesgg* 5
)gg5 6
;gg6 7
}hh 	
publicii 
staticii 
stringii 
DecryptStringii *
(ii* +
stringii+ 1

cipherTextii2 <
,ii< =
stringii> D
keyiiE H
,iiH I
stringiiJ P
keyIviiQ V
)iiV W
{jj 	
trykk 
{ll 
intmm 
keyByteSizemm 
=mm  !
$nummm" $
;mm$ %
boolnn 
useHexnn 
=nn 
truenn "
;nn" #
byteoo 
[oo 
]oo 
keyBytesoo 
=oo  !
newoo" %
byteoo& *
[oo* +
keyByteSizeoo+ 6
]oo6 7
;oo7 8
bytepp 
[pp 
]pp 
ivBytespp 
=pp  
newpp! $
bytepp% )
[pp) *
$numpp* ,
]pp, -
;pp- .
byteqq 
[qq 
]qq 
cipherBytesqq "
=qq# $
Convertqq% ,
.qq, -
FromBase64Stringqq- =
(qq= >

cipherTextqq> H
)qqH I
;qqI J
ifss 
(ss 
useHexss 
)ss 
{tt 
intuu 
lenuu 
=uu 
keyByteSizeuu )
*uu* +
$numuu, -
;uu- .
forvv 
(vv 
intvv 
ivv 
=vv  
$numvv! "
;vv" #
ivv$ %
<vv& '
lenvv( +
;vv+ ,
ivv- .
+=vv/ 1
$numvv2 3
)vv3 4
{ww 
keyBytesxx  
[xx  !
ixx! "
/xx# $
$numxx% &
]xx& '
=xx( )
Convertxx* 1
.xx1 2
ToBytexx2 8
(xx8 9
keyxx9 <
.xx< =
	Substringxx= F
(xxF G
ixxG H
,xxH I
$numxxJ K
)xxK L
,xxL M
$numxxN P
)xxP Q
;xxQ R
ifyy 
(yy 
iyy 
<yy 
$numyy  "
)yy" #
ivByteszz #
[zz# $
izz$ %
/zz& '
$numzz( )
]zz) *
=zz+ ,
Convertzz- 4
.zz4 5
ToBytezz5 ;
(zz; <
keyIvzz< A
.zzA B
	SubstringzzB K
(zzK L
izzL M
,zzM N
$numzzO P
)zzP Q
,zzQ R
$numzzS U
)zzU V
;zzV W
}{{ 
}|| 
else}} 
{~~ 
keyBytes 
= 
Convert &
.& '
FromBase64String' 7
(7 8
key8 ;
); <
;< =
ivBytes
ÄÄ 
=
ÄÄ 
Convert
ÄÄ %
.
ÄÄ% &
FromBase64String
ÄÄ& 6
(
ÄÄ6 7
keyIv
ÄÄ7 <
)
ÄÄ< =
;
ÄÄ= >
}
ÅÅ 
using
ÉÉ 
Aes
ÉÉ 
aes
ÉÉ 
=
ÉÉ 
Aes
ÉÉ  #
.
ÉÉ# $
Create
ÉÉ$ *
(
ÉÉ* +
)
ÉÉ+ ,
;
ÉÉ, -
aes
ÑÑ 
.
ÑÑ 
Key
ÑÑ 
=
ÑÑ 
keyBytes
ÑÑ "
;
ÑÑ" #
aes
ÖÖ 
.
ÖÖ 
IV
ÖÖ 
=
ÖÖ 
ivBytes
ÖÖ  
;
ÖÖ  !
ICryptoTransform
ÜÜ  
	decryptor
ÜÜ! *
=
ÜÜ+ ,
aes
ÜÜ- 0
.
ÜÜ0 1
CreateDecryptor
ÜÜ1 @
(
ÜÜ@ A
aes
ÜÜA D
.
ÜÜD E
Key
ÜÜE H
,
ÜÜH I
aes
ÜÜJ M
.
ÜÜM N
IV
ÜÜN P
)
ÜÜP Q
;
ÜÜQ R
using
áá 
MemoryStream
áá "
memoryStream
áá# /
=
áá0 1
new
áá2 5
MemoryStream
áá6 B
(
ááB C
cipherBytes
ááC N
)
ááN O
;
ááO P
using
àà 
CryptoStream
àà "
cryptoStream
àà# /
=
àà0 1
new
àà2 5
CryptoStream
àà6 B
(
ààB C
memoryStream
ààC O
,
ààO P
	decryptor
ààQ Z
,
ààZ [
CryptoStreamMode
àà\ l
.
ààl m
Read
ààm q
)
ààq r
;
ààr s
using
ââ 
StreamReader
ââ "
streamReader
ââ# /
=
ââ0 1
new
ââ2 5
StreamReader
ââ6 B
(
ââB C
cryptoStream
ââC O
)
ââO P
;
ââP Q
return
ãã 
streamReader
ãã #
.
ãã# $
	ReadToEnd
ãã$ -
(
ãã- .
)
ãã. /
;
ãã/ 0
}
åå 
catch
çç 
(
çç 
	Exception
çç 
)
çç 
{
éé 
return
êê 
$str
êê 
;
êê 
}
ëë 
}
îî 	
}
ïï 
}ññ 